 #  Copyright 2019 Christopher Edwards
 # 
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 # 
 #     http://www.apache.org/licenses/LICENSE-2.0
 # 
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.

# Disable warnings generated by the compiler
# This must be before the CMAKE_MODULE_PATH as it changes a default setting
set(MUMPS_NOWARNING ON CACHE BOOL "" FORCE)

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/ydbcmake/")

project(MUnit C MUMPS)
cmake_minimum_required(VERSION 2.8)

# Find YottaDB
find_package(YOTTADB REQUIRED)
include_directories("${YOTTADB_INCLUDE_DIRS}")

set(ydb_install_dir ${YOTTADB_INCLUDE_DIRS}/plugin)

set(source_files
  Routines/_ut.m
  Routines/_ut1.m
  Routines/_utcover.m
  Routines/_utt1.m
  Routines/_utt2.m
  Routines/_utt3.m
  Routines/_utt4.m
  Routines/_utt5.m
  Routines/_utt6.m
  Routines/_utt7.m
  Routines/_uttcovr.m
)

# Add commands to compile .m files
add_library(_ydbmunit SHARED ${source_files})

SET_TARGET_PROPERTIES(_ydbmunit PROPERTIES PREFIX "")

install(FILES ${source_files} DESTINATION ${ydb_install_dir}/r/)

if(MUMPS_UTF8_MODE)
  install(FILES ${CMAKE_CURRENT_BINARY_DIR}/_ydbmunit.so
    DESTINATION ${ydb_install_dir}/o/utf8
  )
else()
  install(FILES ${CMAKE_CURRENT_BINARY_DIR}/_ydbmunit.so
    DESTINATION ${ydb_install_dir}/o/
  )
endif()
